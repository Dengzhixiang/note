# 消息队列的应用

* 异步处理
* 流量控制（令牌桶）
* 服务解耦

# 消息队列需要解决的问题

* 确保消息的有序性
* 防止消息的丢失
* 重复消息的处理：重复消息的处理存在三种标准：at most once；at least once（kafka）；exactly once

# 硬件同步原语

* CAS
* FAA

# 随手记

RocketMQ的NameServer和kafka的zookeeper的作用类似，提供路由功能。

# 事务的实现

RocketMQ提供的事务api中会让提供本地事物执行的代码逻辑和本地事物状态反查的逻辑，发送消息时会加上事物标示，发送成功就会之行本地事物。broker收到消息会根据标示进行判断是否为事物消息，如果是会将该消息存储在一个特殊的主题中。在 Broker 中会启动一个定时器，定时从事务消息队列中读出所有待反查的消息，针对每个需要反查的消息，Broker 会给对应的 Producer 发一个要求执行事务状态反查的 RPC 请求，根据 RPC 返回响应中的反查结果，来决定这个事物消息是需要提交还是回滚，或者后续继续来反查。